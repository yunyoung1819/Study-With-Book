# :book: 엘라스틱서치 쿡북

###### 엘라스틱서치 쿡북을 읽고 그 내용을 요약한 글 입니다. 상세 내용은 책을 참조해주세요.

---------------------------------------------------------------------------

## :pushpin: 4장. 기본 작업

### 색인 생성

- 일래스틱서치에서 데이터를 색인하기 전 첫 작업은 데이터의 주 컨테이너라고 할 수 있는 색인을 만드는 것이다.
- 색인은 SQL에서 데이터베이스 개념
- 타입(SQL에서 테이블)과 도큐먼트(SQL에서 레코드)를 위한 컨테이너다.
- 색인 생성을 위한 HTTP 메소드는 PUT(POST 역시 동작한다)이고, REST URL은 색인 이름을 포함한다.

````
http://<서버>/<색인_이름>
````

- 색인을 작성할 때 복제는 settings/index 객체에서 다음 두 파라미터로 설정할 수 있다.
    - number_of_shards: 색인을 작성하는 샤드 개수를 제어한다.
    - number_of_replicas: 복제 개수를 제어한다. 이 값은 1 이상으로 설정하는 것이 좋다.
- 색인 생성 API는 생성 시간에 매핑을 정의할 수 있다.
- 매핑을 정의하는데 필요한 파라미터가 mappings이고, 다중 매핑을 허용한다.
- 색인 이름에는 몇 가지 제약 사항이 있는데, 허용 문자는 다음과 같다.
    - 아스키 문자 [a-z]
    - 숫자 [0-9]
    - 마침표., 마이너스 -, &, _


### 색인 삭제

- 색인 삭제는 색인의 샤드, 매핑, 데이터를 삭제한다.
- 색인 삭제를 위한 HTTP 메소드는 DELETE다.
````
http://<서버>/<색인_이름>
````

- 전체 색인 삭제 비활성화
````
action.destructive_requires_name: true
````


### 색인 열고 닫기
- 데이터를 유지하면서 자원(메모리/CPU)을 절약하려면 색인을 삭제하는 대신 닫아두는 것이 좋다.
- 일래스틱서치는 색인을 열거나 닫아 온라인이나 오프라인 모드로 설정할 수 있다.
- 색인 닫기 
````
curl -XPOST http://127.0.0.1:9200/myindex/_close
````
- 색인 열기
````
curl -XPOST http://127.0.0.1:9200/myindex/_open
````

### 색인에 매핑 입력

- 커맨드라인을 통해 curl을 실행하려면 운영체제에 curl을 설치해야 한다.
- 매핑을 입력하기 위한 HTTP 메소드는 PUT(물론 POST도 동작한다)이고, 매핑 입력의 URL 형식은 다음과 같다.
````
http://<서버>/<색인_이름>/<타입_이름>/_mapping
````
- 매핑이 삽입될 때 같은 타입의 매핑이 있다면 새 매핑과 병합한다.
- 다른 유형의 필드가 이미 있다면 업데이트할 수 없으므로 필드 속성을 확장하는 예외가 나타날 것이다.
- PUT 매핑 호출은 쉼표로 구분한 색인 목록이나 _all 앨리어스를 사용하는 전체 색인에 적용하는 것으로, 여러 색인 타입을 한 번에 설정할 수 있다.


### 매핑 삭제
- 매핑을 위한 삭제 작업은 없다. 즉 색인에서 단일 매핑을 삭제할 수 없다.
- 매핑을 삭제하거나 변경하려면 다음 절차를 실행해야 한다.

1. 신규 또는 변경한 매핑으로 새 색인을 만든다.
2. 전체 레코드를 다시 색인한다.
3. 잘못된 매핑을 가진 기존 색인을 삭제한다.

 