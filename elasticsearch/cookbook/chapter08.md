# :book: 엘라스틱서치 쿡북

###### 엘라스틱서치 쿡북을 읽고 그 내용을 요약한 글 입니다. 상세 내용은 책을 참조해주세요.

---------------------------------------------------------------------------

## :pushpin: 8장. 집계 

### 집계 실행
- 일래스틱서치는 검색 이외의 몇 가지 기능을 제공하는데, 검색에서 집계를 통해 통계와 실시간 분석을 실행할 수 있다.

### 예제 구현
- name으로 상위 10개 태그를 계산

```
curl -XGET 'http://127.0.0.1:9200/test-index/test-type/_search?pretty&size=0' -d '{
    "query": {
        "match_all": {}
    },
    "aggregations": {
        "tag": {
            "terms": {
                "field": "tag",
                "size": 10
            }
        }
    }
}'
```

### 일래스틱서치에서 사용할 수 있는 몇 가지 집계 유형
- 집계는 항상 검색 조회 시 실행되며, 보통 맵/리듀스 방식으로 연산된다.
    - 카운팅
    - 히스토그램
    - 범위 집계
    - 통계
    - 지리적 거리 집계
    

### stats 집계 실행
- 가장 일반적으로 사용하는 매트릭 집계는 stat 집계다. 
- min: 버킷 그룹의 최솟값을 계산
- max: 버킷 그룹의 최댓값을 계산
- avg: 버킷 그룹의 평균값을 계산
- sum: 모든 버킷의 합계를 계산
- value_count: 버킷에 있는 값의 개수를 계산 
- stats: min, max, avg, count, sum처럼 모든 기반 매트릭을 연산
- extended_stats: stats 매트릭에 더해 분산, 표ㅕ준편차, 제곱의 합을 계산
- percentiles: 특정 값의 백분위를 계산
- percentile_ranks: 백분위 범위를 기록한 값의 순위를 계산
- cardinality: 특정 필드의 고유한 값의 대략적인 개수를 계산
- geo_bounds: 지오포인트가 있는 도큐먼트의 최대 지리적 경계를 계산
- geo_centroid: 지오포인트가 있는 도큐먼트의 중심점을 계산 

````
"aggs": {
    "<집계_이름>": {
        "<매트릭_이름>": {
            "field": "<필드_이름>"
        }
    }
}
````