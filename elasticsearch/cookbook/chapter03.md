# :book: 엘라스틱서치 쿡북

###### 엘라스틱서치 쿡북을 읽고 그 내용을 요약한 글 입니다. 상세 내용은 책을 참조해주세요.

---------------------------------------------------------------------------

## :pushpin: 3장. 매핑 관리

- 일래스틱서치에 있어 매핑은 검색 엔진이 도큐먼트를 처리하는 방법을 정의하기 때문에 매우 중요한 개념임
- 검색 엔진은 두 개의 주요 기능을 수행한다.
    - 색인 기능: 도큐먼트를 받아 색인에 저장/색인/처리하는 작업
    - 검색 기능: 색인에서 데이터를 검색하는 작업 

### 명시적 매핑 사용

- 색인을 SQL 세상에서 데이터베이스로 간주한다면 매핑은 테이블 정의와 유사하다. 

- 일래스틱서치는 색인을 만들 도큐먼트 구조를 이해할 수 있고(구조를 반영), 매핑 정의를 
자동으로 생성할 수 있다(명시적인 매핑을 생성).


### 예제

- 색인을 생성한다.
```
curl -XPUT http://127.0.0.1:9200/test
```

- 색인에 도큐먼트를 입력한다.
```
curl -XPUT http://127.0.0.1:9200/test/mytype/1 -d
'{"name": "Paul", "age":35}'
```

- 매핑을 조회하고 읽기 좋은 형식으로 출력한다.
````
curl -XGET http://127.0.0.1:9200/test/mytype/_mapping?pretty-true
````

### 예제 분석

- 도큐먼트 색인 단계에서 일래스틱서치는 mytype이 존재하는지 확인하고 그렇지 않다면 동적으로 하나를 생성한다.
- 일래스틱서치는 매핑 필드의 모든 기본 속성을 읽고 처리하기 시작
    - 매핑에 필드가 이미 있으면서 필드의 값이 유효하면(올바른 필드 타입으로 매치되면) 현재 매핑을 변경할 필요가 없다.
    - 매핑에 필드가 이미 있으나 필드의 값이 다른 필드 타입이라면 필드 타입의 업그레이드를 시도한다. 타입이 호환되지 않는다면 예뢰를 던지고 색인 과정은 실패한다.
    - 필드가 없다면 필드의 타입을 자동으로 알아내 새 필드 매핑으로 매핑을 변경한다.
- 매핑 타입을 생성하거나 변경한다면 일래스틱서치는 매핑 변경을 자동으로 클러스터의 모든 노드에 전파하고, 모든 샤드는 특정 타입을 처리하도록 조정된다.

